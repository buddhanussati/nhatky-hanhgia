<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="image/x-icon" href="./images/favicon.ico">
	<link rel="manifest" href="./manifest2.json">
    <meta name="theme-color" content="#8b5cf6">
    <link rel="apple-touch-icon" href="./images/icon-192.png">
    <title>Meditator's Journal</title>
    <link href="./css/css.css" rel="stylesheet">
	<link href="./css/css2.css" rel="stylesheet">
 	<script src="./js/chart.js"></script>
    
</head>
<body>

<nav class="sidebar">
        <div class="logo"><i class="fas fa-hourglass-empty"></i></div>
        <div class="nav-item active" onclick="app.switchView('dashboard')">
            <i class="fas fa-spa"></i><span class="nav-text">Journal</span>
        </div>
        <div class="nav-item" onclick="app.switchView('calendar')">
            <i class="fas fa-calendar-alt"></i><span class="nav-text">Calendar</span>
        </div>
        <div class="nav-item" onclick="app.switchView('reports')">
            <i class="fas fa-chart-pie"></i><span class="nav-text">Statistics</span>
        </div>
		<div class="nav-item" onclick="app.switchView('analytics')">
    <i class="fas fa-microscope"></i><span class="nav-text">Analytics</span>
</div>
  
<div class="nav-item" onclick="app.switchView('pro')">
    <i class="fas fa-gem"></i><span class="nav-text">Advanced</span>
</div>
        
        
         <div class="nav-item" onclick="app.switchView('achievements')">
            <i class="fas fa-medal"></i><span class="nav-text">PƒÅramƒ´</span>
        </div>

        <div class="nav-item" onclick="app.resetApp()" style="color: var(--danger);"> <i class="fas fa-trash-alt"></i><span class="nav-text">Reset</span>
        </div>
    </nav>


    <main class="main">
        <header>
            <div>
                <h1 id="page-title">Meditator's Journal</h1>
                <p style="color: var(--text-light); font-size: 14px;" id="current-date"></p>
            </div>
            
            <div class="user-stats">
                <div class="stat-item active-badge-container" onclick="app.openBadgePicker()" title="Nh·∫•n ƒë·ªÉ ƒë·ªïi huy hi·ªáu hi·ªÉn th·ªã">
    <div id="current-active-badge" class="badge-display">
        <i class="fas fa-award"></i>
    </div>
</div>
                <div class="stat-item">
                    <span class="stat-val" id="streak-disp">0 üî•</span>
                    <span class="stat-label">Streak</span>
                </div>
                <div class="stat-item">
                    <span class="stat-val" id="xp-disp">0</span>
                    <span class="stat-label">Mindfulness</span>
                </div>
				
				<div class="stat-item clickable" onclick="app.exportData()">
    <span class="stat-val" style="
        width: 24px; 
        height: 24px; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-size: 15px;"><i class="fas fa-save"></i></span>
</div>

				 <div class="stat-item clickable" onclick="app.openIntroModal()">
    <span class="stat-val" style="
        border: 2px solid var(--text-light); 
        border-radius: 50%; 
        width: 24px; 
        height: 24px; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-size: 14px;">?</span>
</div>
                <button class="btn" onclick="app.openChoiceModal()">
                    <i class="fas fa-plus"></i> New Goal
                </button>
            </div>
        </header>

        <section id="view-dashboard" class="view-section active">
            <div id="active-goals-container" class="dashboard-grid"></div>
            <div id="empty-msg" class="empty-state" style="display:none;">
                <i class="fas fa-clipboard-list" style="font-size: 40px; margin-bottom: 10px;"></i>
                <p>No active goals. Create one to start tracking!</p>
            </div>
        </section>

        <section id="view-calendar" class="view-section">
		<div class="card" 
     onclick="app.renderRandomQuote()" 
     title="Tap to reflect on another verse"
     style="margin: 0 auto 20px auto; text-align: center; border-left: 5px solid var(--zen); cursor: pointer; transition: transform 0.2s; user-select: none; max-width: 450px;"
     onmouseover="this.style.transform='translateY(-2px)'" 
     onmouseout="this.style.transform='translateY(0)'">
    
    <h3 style="color: var(--zen); margin-bottom: 15px;">
        <i class="fas fa-dharmachakra"></i> Dhammapada
    </h3>
    
    <div id="dhammapada-display" style="
        font-style: italic; 
        font-size: 15px; 
        line-height: 1.6; 
        color: var(--text); 
        min-height: 60px; 
        padding: 0 10px;
        display: flex; 
        align-items: center; 
        justify-content: center;
        transition: opacity 0.3s ease;">
        </div>

    <div id="dhammapada-source" style="font-size: 11px; color: var(--text-light); margin-top: 15px; opacity: 0.7;">
</div>
</div>
            <div class="card">
                <h3 style="text-align: center;">Activity Calendar</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0;">
                    <button class="btn btn-secondary" onclick="app.changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                    <h4 id="cal-month-year">Month Year</h4>
                    <button class="btn btn-secondary" onclick="app.changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-grid" id="calendar-grid"></div>
            </div>
			
        </section>

        <section id="view-reports" class="view-section">
    <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 25px;">
        <button class="btn" id="btn-rep-time" onclick="app.setReportMode('time')">
            <i class="fas fa-clock"></i> Time
        </button>
        <button class="btn btn-secondary" id="btn-rep-mind" onclick="app.setReportMode('mindfulness')">
            <i class="fas fa-spa"></i> Mindfulness
        </button>
    </div>

    <div class="dashboard-grid" style="grid-template-columns: 1fr;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
            <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h4 id="breakdown-title" style="margin: 0;">Time</h4>
        
        <select id="report-range-select" class="form-control" style="width: auto; padding: 5px; font-size: 13px; height: 32px;" onchange="app.renderReports(true)">
            <option value="all">All Time</option>
            <option value="today">Today</option>
			<option value="yesterday">Yesterday</option>
            <option value="this_week" selected>This Week</option>
            <option value="last_week">Last Week</option>
            <option value="this_month">This Month</option>
            <option value="last_month">Last Month</option>
        </select>
    </div>
    
    <div style="height: 300px; display:flex; justify-content:center;">
        <canvas id="goalBreakdownChart"></canvas>
    </div>
</div>
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <button class="btn btn-secondary" style="padding: 5px 10px;" onclick="app.changeReportWeek(-1)"><i class="fas fa-chevron-left"></i></button>
                    <h4 id="weekly-report-title">Weekly Focus</h4>
                    <button class="btn btn-secondary" style="padding: 5px 10px;" onclick="app.changeReportWeek(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div style="height: 300px;">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <button class="btn btn-secondary" style="padding: 5px 10px;" onclick="app.changeReportMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                <h4 id="monthly-report-title">Monthly Focus</h4>
                <button class="btn btn-secondary" style="padding: 5px 10px;" onclick="app.changeReportMonth(1)"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div style="height: 300px;">
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>
    </div>
	<div class="card" style="margin-top: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <button class="btn btn-secondary" style="padding: 5px 10px;" onclick="app.changeReportMonth(-1)">
            <i class="fas fa-chevron-left"></i>
        </button>
        <div>
            <h4 style="margin: 0; display:inline-block;">Mindful-Awareness</h4>
            <p id="density-month-title" style="font-size: 12px; color: var(--text-light); margin: 0; text-align: center; margin-top:2px;">
                This month
            </p>
        </div>
        <button class="btn btn-secondary" style="padding: 5px 10px;" onclick="app.changeReportMonth(1)">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>

  
    <div style="height: 250px;">
        <canvas id="reportDensityChart"></canvas>
    </div>
</div>
	
</section>
<section id="view-analytics" class="view-section">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
    <h2 style="margin: 0;">Meditation Analytics</h2>
  <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
            <select id="ana-goal-select" class="form-control" style="width: auto; max-width: 150px;" onchange="app.renderAnalytics(true)">
                </select>

            <select id="ana-time-range" class="form-control" style="width: auto;" onchange="app.renderAnalytics()">
			<option value="3" selected>Last 3 days</option>
            <option value="7">Last 7 days</option>
			<option value="14">Last 14 days</option>
            <option value="30">Last 30 days</option>
            <option value="90">Last 3 months</option>
            <option value="365">All time</option>
        </select>
    </div>
</div>
    <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 20px;">
        <div class="card" style="text-align: center; border-left: 4px solid var(--success);">
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase;">Average Quality</div>
            <div style="font-size: 28px; font-weight: bold; margin: 5px 0;" id="ana-avg-quality">0%</div>
            <div style="font-size: 11px; color: var(--text-light);">Mindfulness / Time</div>
        </div>
        <div class="card" style="text-align: center; border-left: 4px solid var(--primary);">
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase;">Mindfulness Ratio</div>
            <div style="font-size: 28px; font-weight: bold; margin: 5px 0;" id="ana-avg-density">0</div>
            <div style="font-size: 11px; color: var(--text-light);">Mindfulness per minute</div>
        </div>
        <div class="card" style="text-align: center; border-left: 4px solid var(--danger);">
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase;">Total Mindfulness</div>
            <div style="font-size: 28px; font-weight: bold; margin: 5px 0;" id="ana-total-mindful">0h</div>
            <div style="font-size: 11px; color: var(--text-light);">Focused Time</div>
        </div>
    </div>

    <div class="dashboard-grid" style="grid-template-columns: 1fr; gap: 20px;">
        <div class="card">
            <h3>üìà Mindfulness Trend</h3>
            <p style="font-size: 12px; color: var(--text-light); margin-bottom: 15px;">Track mindfulness quality across sessions</p>
            <div style="height: 300px;">
                <canvas id="analyticsTrendChart"></canvas>
            </div>
        </div>
<div class="card" style="margin-top: 20px;">
    <h3>üìä Daily Awareness</h3>
    <p style="font-size: 12px; color: var(--text-light); margin-bottom: 15px;">
        Daily mindful quality & total practice time
    </p>
    <div style="height: 250px;">
        <canvas id="analyticsHourlyChart"></canvas>
    </div>
</div>
        <div class="card">
  <h3><i class="fas fa-chart-area"></i> Performance Comparison</h3>
  <div style="margin-top: 15px;">
    <table style="width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed;">
      <thead>
        <tr style="border-bottom: 2px solid var(--border); color: var(--text-light);">
          <th style="text-align: left; padding: 10px;">Period</th>
          <th style="text-align: center; padding: 10px;">Session</th>
          <th style="text-align: center; padding: 10px;">Total Hours</th>
          <th style="text-align: center; padding: 10px;">Quality</th>
          <th style="text-align: center; padding: 10px;">Mindful per min</th>
        </tr>
      </thead>
      <tbody id="ana-comparison-table">
      </tbody>
    </table>
  </div>
</div>

    </div>
</section>
     <section id="view-pro" class="view-section">
    <div class="dashboard-grid" style="grid-template-columns: 1fr;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="margin: 0;">üíé Focus Quality</h4>
                    <select id="pro-range-select" class="form-control" style="width: auto; padding: 5px; font-size: 13px; height: 32px;" onchange="app.renderProAnalytics(true)">
                        <option value="all">All Time</option>
            <option value="today" >Today</option>
			<option value="yesterday">Yesterday</option>
            <option value="this_week" selected>This Week</option>
            <option value="last_week">Last Week</option>
            <option value="this_month">This Month</option>
            <option value="last_month">Last Month</option>
                    </select>
                </div>
                <div style="height: 300px; display:flex; justify-content:center;">
                    <canvas id="proBreakdownChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <button class="btn btn-secondary" style="padding: 5px 10px;" onclick="app.changeProWeek(-1)"><i class="fas fa-chevron-left"></i></button>
                    <h4 id="pro-weekly-title">This Week</h4>
                    <button class="btn btn-secondary" style="padding: 5px 10px;" onclick="app.changeProWeek(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div style="height: 300px;">
                    <canvas id="proWeeklyChart"></canvas>
                </div>
            </div>
        </div>
<div class="card" style="margin-top: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h4 style="margin: 0;">üìà Focus Trend</h4>
        <select id="pro-trend-select" class="form-control" style="width: auto; padding: 5px; font-size: 13px; height: 32px;" onchange="app.renderProTrendChart()">
            <option value="3" selected>Last 3 days</option>
            <option value="7">Last 7 days</option>
            <option value="14">Last 14 days</option>
            <option value="30">Last 30 days</option>
            <option value="all">All time</option>
        </select>
    </div>
    <p style="font-size: 11px; color: var(--text-light); margin-bottom: 15px;">
        Average focus quality across meditation sessions
    </p>
    <div style="height: 300px;">
        <canvas id="proTrendChart"></canvas>
    </div>
</div>
        <div class="card" style="margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <button class="btn btn-secondary" style="padding: 5px 10px;" onclick="app.changeProMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                <h4 id="pro-monthly-title">This Month</h4>
                <button class="btn btn-secondary" style="padding: 5px 10px;" onclick="app.changeProMonth(1)"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div style="height: 300px;">
                <canvas id="proMonthlyChart"></canvas>
            </div>
        </div>
    </div>
</section>
<section id="view-achievements" class="view-section">
            <div class="card" style="margin-top: 30px;">
                <h3 style="text-align: center;"><i class="fas fa-award"></i> PƒÅramƒ´</h3>
                <div id="achievement-list" style="margin-top: 20px; display: grid; gap: 10px;"></div>
            </div>
        </section>
    </main>

    <div class="modal" id="choice-modal">
        <div class="modal-content">
            <h2 style="text-align:center;">Choose Goal Type</h2>
            <div class="choice-btn-container">
                <div class="choice-card" onclick="app.openModal(null, 'meditation')">
                    <i class="fas fa-spa" style="color: var(--zen);"></i>
                    <h3>Meditate</h3>
                    <p style="font-size:12px; color:var(--text-light); margin-top:5px;">Track Mindfulness</p>
                </div>
                <div class="choice-card" onclick="app.openModal(null, 'standard')">
                    <i class="fas fa-tasks" style="color: var(--primary);"></i>
                    <h3>Activity</h3>
                    <p style="font-size:12px; color:var(--text-light); margin-top:5px;">Track Progress</p>
                </div>
            </div>
            <button class="btn btn-secondary" style="width:100%; margin-top:20px;" onclick="app.closeChoiceModal()">Cancel</button>
        </div>
    </div>

    <div class="modal" id="goal-modal">
        <div class="modal-content">
            <h2 id="modal-title" style="margin-bottom: 20px;">Create New Goal</h2>
            <form onsubmit="app.saveGoal(event)">
                <input type="hidden" id="g-id"> 
                <input type="hidden" id="g-type"> 
                
                <div class="form-group">
                    <label>Goal Name</label>
                    <input type="text" id="g-name" class="form-control" required>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="g-cat" class="form-control">
                            </select>
                    </div>
                    <div class="form-group">
                        <label>Color</label>
                        <input type="color" id="g-color" class="form-control" value="#6366f1">
                    </div>
                </div>
                
                <div class="form-group" style="background: rgba(16, 185, 129, 0.1); padding: 10px; border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
                    <label style="color: var(--success);">Daily Target</label>
                    <input type="number" id="g-daily-target" class="form-control" min="0" value="30">
                    <small id="g-daily-hint" style="color: var(--success); font-size: 11px;">Minutes per day</small>
                </div>
                
                <div class="form-group">
                    <label>Achieve in</label>
                    <input type="number" id="g-lifetime-target" class="form-control" required min="1" value="1000">
                    <small id="g-life-hint" style="color: var(--text-light); font-size: 11px;">Minutes</small>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                    <button type="submit" class="btn" id="btn-save-goal">Create Goal</button>
                </div>
            </form>
        </div>
    </div>
<div class="modal" id="backup-modal">
    <div class="modal-content">
        <h2 style="margin-bottom: 10px; text-align: center;">Back up & Restore</h2>
        
        <div class="desktop-actions" style="margin-bottom: 20px;">
            <p style="color: var(--text-light); text-align: center; font-size: 12px; margin-bottom: 10px;">
                <i class="fas fa-box-archive"></i> <strong>Backup & restore data from file:</strong>
            </p>
            <div style="display: flex;  justify-content: center; gap: 10px;">
                <button class="btn" style="flex: 1;" onclick="app.downloadFile()">
                    <i class="fas fa-download"></i> Backup
                </button>
                <button class="btn btn-secondary"; style="flex: 1;" onclick="document.getElementById('backup-file-input').click()">
                    <i class="fas fa-file-import"></i> Restore
                </button>
                <input type="file" id="backup-file-input" style="display: none;" accept=".json, .txt" onchange="app.handleFileUpload(this)">
            </div>
        </div>
<div style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;">
    
    <button class="btn btn-secondary" style="flex: 1;" onclick="app.shareBackup()">
        <i class="fas fa-share-alt"></i> Share
    </button>

    <button class="btn btn-secondary" style="flex: 1; border-color: var(--danger); color: var(--danger);" onclick="app.closeBackupModal()">
        Close
    </button>
</div>
</div></div>
    <div class="modal" id="session-modal">
    <div class="modal-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 id="session-title" style="margin: 0;">Log Session</h2>
            <button type="button" id="btn-delete-session" class="btn-icon" 
                style="background: transparent; color: var(--danger); display: none; width: 30px; height: 30px;" 
                onclick="app.deleteSession()"
                title="Delete this session">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        <form onsubmit="app.logSessionConfirm(event)">
                <input type="hidden" id="s-goal-id" />
                <input type="hidden" id="s-log-id" />
                
                <div class="form-group">
                    <label>Start Date & Time</label>
                    <input type="datetime-local" id="s-date" class="form-control" required />
                </div>
                
                <div class="form-group">
                    <label>Duration (Minutes)</label>
                    <input type="number" id="s-minutes" class="form-control" required min="1" />
                </div>
<div class="form-group" id="s-mindfulness-group" style="display:none; background: rgba(167, 139, 250, 0.1); padding: 10px; border-radius: 8px; border: 1px solid rgba(167, 139, 250, 0.3);">
    <label style="color: var(--zen);">Mindfulness (Count)</label>
    <input type="number" id="s-mindfulness" class="form-control" min="0" value="0" />
	    <div style="margin-top: 10px; border-top: 1px solid rgba(167, 139, 250, 0.3); padding-top: 10px;">
        <label style="color: var(--zen); font-size: 12px;">Distraction Threshold (secs)</label>
        <input type="number" id="s-threshold" class="form-control" min="1" value="12" style="background: rgba(0,0,0,0.2);" />
    </div>
</div>
                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea id="s-notes" class="form-control" placeholder="What did you focus on?"></textarea>
                    <div id="session-tags" class="tag-container"></div>
                   </div>

                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" class="btn btn-secondary" onclick="app.closeSessionModal()">Cancel</button>
                    <button type="submit" class="btn">Save</button>
                </div>
            </form>
        </div>
    </div>

    <div id="meditation-overlay">
        <div class="med-timer-disp" id="med-timer">00:00</div>
        <div class="med-controls">
    <button class="btn btn-secondary" onclick="app.openMedSettings()" title="Touch settings">
        <i class="fas fa-cog"></i>
    </button>
    
    <button class="btn" style="background-color: var(--danger); color: white;" onclick="app.concludeMeditationSession()"><i class="fas fa-stop"></i></button>
</div>
        <div id="med-quote-container" class="med-quote-box">
    <div id="med-quote-text" style="font-style: italic; font-size: 14px; margin-bottom: 8px; line-height: 1.4; text-shadow: 0 2px 4px rgba(0,0,0,0.8);"></div>
</div>
        <div class="meditation-circle" id="med-counter">0</div>
        
        <div class="med-instruction">Tap Screen for Mindfulness</div>
    </div>

    <div class="modal" id="meditation-finish-modal">
        <div class="modal-content">
            <h2 style="text-align: center; margin-bottom: 10px;">Session Complete üåø</h2>
            <div style="text-align:center; margin: 20px 0; display:flex; justify-content:space-around; align-items:center;">
                <div>
                    <div style="font-size: 30px; font-weight:bold; color:var(--zen)" id="med-finish-count">0</div>
                    <div style="color:var(--text-light); font-size:12px;">Mindfulness</div>
                </div>
                <div style="height:40px; width:1px; background:var(--border);"></div>
                <div>
                    <div style="font-size: 30px; font-weight:bold; color:var(--text)" id="med-finish-time">0m</div>
                    <div style="color:var(--text-light); font-size:12px;">Time Spent</div>
                </div>
            </div>
            <div class="form-group">
                <label>Journal Notes</label>
                <textarea id="med-finish-notes" class="form-control" placeholder="Any insights or distractions?"></textarea>
				<div id="finish-tags" class="tag-container"></div>
            </div>
             <div id="med-finish-actions" style="display:flex; gap:10px; justify-content:flex-end; margin-top:20px;">
             <button id="btn-med-discard" class="btn btn-secondary" onclick="app.discardMeditation()">Discard</button>
             <button id="btn-med-save" class="btn" style="background:var(--zen); color:white" onclick="app.saveMeditationLog()">Save to Journal</button>
            </div>
        </div>
    </div>

    <div class="modal" id="graph-modal" style="overflow-y: auto; z-index: 150;">
        <div class="modal-content" style="width: 600px;">
            <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom: 20px;">
                <div>
                    <h2 style="margin-bottom: 5px;">Meditation Session</h2>
                    <p id="graph-date" style="color: var(--text-light); font-size: 14px; margin: 0;"></p>
             </div>
               
            </div>

            <div style="height: 300px; width: 100%;">
                <canvas id="sessionGraph"></canvas>
            </div>
            
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
			 <button class="btn btn-secondary" id="btn-export-session" title="Copy JSON Data">
                    <i class="fas fa-file-code"></i>
                </button>
			<select id="graph-type-select" class="form-control" style="width: auto; padding: 5px 5px 5px; height: 36px; font-size: 13px; cursor: pointer;" onchange="app.updateSessionChart()">
			                    <option value="interval">‚òÅÔ∏è Distraction</option>
                    <option value="intensity">üå± Mindfulness</option>
                <option value="pro">üíé Focus Quality</option> </select>
               <button class="btn btn-secondary" onclick="document.getElementById('graph-modal').style.display='none'" title="Close"><i class="fas fa-xmark"></i></button>
            </div>
        </div>
    </div>

    <div class="modal" id="day-details-modal" style="overflow-y: auto;">
    <div class="modal-content">
        <h2 id="day-modal-title" style="margin-bottom: 10px; font-size: 20px;">Day Details</h2>
        
        <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 15px;">
            <button class="btn" id="btn-modal-time" style="padding: 5px 15px; font-size: 12px;" onclick="app.switchDayChart('time')">
                <i class="fas fa-clock"></i> Time
            </button>
            <button class="btn btn-secondary" id="btn-modal-mind" style="padding: 5px 15px; font-size: 12px;" onclick="app.switchDayChart('mindfulness')">
                <i class="fas fa-spa"></i> Mindfulness
            </button>
        </div>

        <div style="height: 200px; position: relative; margin-bottom: 20px;">
            <canvas id="dayBreakdownChart"></canvas>
        </div>

        <h3 style="font-size: 14px; color: var(--text-light); border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-bottom: 10px;">Activity Log</h3>
        <div id="day-session-list" style="max-height: 150px; overflow-y: auto;"></div>
        
        <div style="display: flex; justify-content: flex-end; margin-top: 20px; border-top: 1px solid var(--border); padding-top: 15px;">
            <button class="btn btn-secondary" onclick="app.closeDayModal()">Close</button>
        </div>
    </div>
</div>

    <div id="toast" class="toast">
        <i class="fas fa-info-circle"></i> <span id="toast-msg">Message</span>
    </div>
	
	<div class="modal" id="med-settings-modal" style="z-index: 2000;">
    <div class="modal-content" style="max-width: 350px;">
        <h3 style="margin-bottom: 10px; text-align: center;">
            Interaction Settings 
            <i class="fas fa-info-circle" 
               style="cursor: help; color: var(--primary); margin-left: 5px;" 
               onclick="app.showInteractionInfo()" 
               title="Nh·∫•n ƒë·ªÉ xem ƒë·ªãnh nghƒ©a"></i>
        </h3>
        
        <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 13px; color: var(--text-light); text-align: center;">
            <i class="fas fa-fingerprint"></i> <strong>Tap</strong> to record mindfulness,<br>
			<i class="fas fa-hand-pointer"></i> <strong>Hold</strong> to record awareness.
        </div>

        <div class="form-group">
            <label>Hold Duration: <span id="disp-hold-time" style="color:var(--primary)">0.4s</span></label>
            <input type="range" id="inp-hold-time" class="form-control" min="200" max="2000" step="100" oninput="app.updateMedSettingDisplay()">
        </div>

        <div class="form-group" style="background: rgba(251, 191, 36, 0.1); padding: 10px; border-radius: 8px; border: 1px solid rgba(251, 191, 36, 0.3); margin-top: 15px;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <label style="margin:0; color: var(--warning);"><i class="fas fa-check-double"></i> Confirmation Mode</label>
                <input type="checkbox" id="inp-confirm-mode" style="width: 20px; height: 20px; accent-color: var(--warning);" onchange="app.toggleConfirmSlider()">
            </div>
            
            <div id="confirm-slider-group" style="margin-top: 10px; display:none; border-top: 1px solid rgba(251, 191, 36, 0.3); padding-top: 10px;">
                <label style="font-size:12px; color: var(--text-light);">Appearance Frequency: <span id="disp-confirm-prob" style="color:var(--warning); font-weight:bold;">100%</span></label>
                <input type="range" id="inp-confirm-prob" class="form-control" min="10" max="100" step="10" oninput="app.updateConfirmProbDisplay()">
                <div style="font-size: 11px; color: var(--text-light); margin-top: 5px; font-style: italic; line-height: 1.4;">
                    1st touch to "wait", 2nd touch to "confirm".<br>
                    (Only applies to <strong>Low</strong> focus level).
                </div>
            </div>
        </div>

        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;">
            <label style="margin:0"><i class="fas fa-mobile-alt"></i> Haptic Feedback</label>
            <input type="checkbox" id="inp-vibrate" style="width: 20px; height: 20px;" onchange="app.saveMedSettings()">
        </div>

        <div style="margin-top: 25px;">
            <button class="btn" style="width: 100%;" onclick="app.closeMedSettings()">Save & Close</button>
        </div>
    </div>
</div>
	<div class="modal" id="intro-modal" style="z-index: 9999;">
    <div class="modal-content" style="max-width: 800px; width: 95%; max-height: 90vh; display: flex; flex-direction: column; padding: 0;">
        
        <div style="padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: var(--surface); border-radius: 16px 16px 0 0;">
            <h2 style="margin: 0;">‚ú® Meditator's Journal</h2>
            <button class="btn-icon" onclick="app.closeIntroModal()" style="color: var(--text-light); background: transparent;"><i class="fas fa-times"></i></button>
        </div>

        <div style="padding: 20px; overflow-y: auto; line-height: 1.6; color: var(--text-light);">
            
            <p><strong>Meditator's Journal</strong> is an application designed to support both spiritual practice and daily work. The app helps practitioners track progress in their professional tasks as well as meditation sessions, recording levels of awareness through "Mindfulness" counts, and visualizing mental states via real-time charts and graphs.</p>
            
            <img src="./images/1en.png" alt="Dashboard Preview" style="width: 100%; border-radius: 8px; border: 1px solid var(--border); margin: 10px 0;">

            <h3 style="color: var(--text); margin-top: 20px;">‚ú® Core Concepts</h3>
            <p>To use the app effectively, you should understand the following indicators:</p>
            <ul style="padding-left: 20px; margin-bottom: 15px;">
                <li><strong>Mindfulness:</strong> A unit for measuring awareness. Every time you recognize your breath or mental state and touch the screen, one "Mindfulness" point is recorded.</li>
                <li><strong>Mindful State:</strong> A state where the frequency of noting remains stable and regular.</li>
                <li><strong>Unmindful:</strong> A state where the mind is distracted or drowsy, resulting in few or no recordings over a period of time.</li>
                <li><strong>Diligence Streak:</strong> The number of consecutive days you have maintained your practice.</li>
            </ul>

            <h3 style="color: var(--text); margin-top: 20px;">‚ú® Key Features</h3>
            
            <h4 style="color: var(--primary);">1. Diverse Goal Management</h4>
            <ul style="padding-left: 20px;">
                <li><strong>Two main types of goals:</strong>
                    <ul>
                        <li><strong>‡•ê Meditation:</strong> Tracks meditation duration and counts mindfulness recognitions.</li>
                        <li><strong>‚ö° Work:</strong> A traditional countdown timer used for work, study (similar to Pomodoro), or other habits.</li>
                    </ul>
                </li>
                <li><strong>Customization:</strong> Set daily goals (minutes), target completion time, representative colors, and management categories.</li>
            </ul>
            <h4 style="color: var(--primary); margin-top: 15px;">2. Interaction Settings</h4>
<p>In the meditation interface, tap the <i class="fas fa-cog"></i> button to open interaction settings. The app supports haptic feedback vibration and helps you record two mental states simultaneously with 4 levels of mindfulness intensity.</p>

<div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; border: 1px solid var(--border);">
    <ul style="padding-left: 20px; margin: 0;">
        <li style="margin-bottom: 12px;">
            <i class="fas fa-fingerprint" style="color: var(--zen); width: 20px;"></i> <strong>Tap = Mindfulness (Keeping the mind on the Object):</strong> 
            <br>Lightly tap the screen to record focus on your meditation object. For example: one tap for each full breath (in & out) counts as one mindfulness.
            <div style="font-size: 13px; color: var(--text-light); margin-top: 4px;">
                <em>*<strong>Combo Mechanism:</strong></em> Every session starts at <b>Low</b> intensity. For every 12 or 20 consecutive entries with a time gap ‚â§ <i>Distraction Threshold</i>, the mindfulness level increases by one tier (Low ‚Üí Mid ‚Üí Good ‚Üí High). Exceeding the threshold resets the combo to Low.
            </div>
        </li>
        
        <li style="margin-bottom: 12px;">
            <i class="fas fa-hand-pointer" style="color: #818cf8; width: 20px;"></i> <strong>Hold = Awareness (Recognizing mental states, Detecting distractions):</strong> 
            <br>Press and hold the screen to record Awareness. Awareness is when you <b>realize</b> your current state of mind (e.g., catching your mind wandering, having stray thoughts, or losing focus on the object). This is the moment of recognition and returning.
        </li>

        <li style="margin-top: 5px; border-top: 1px solid rgba(251, 191, 36, 0.2); padding-top: 10px;">
            <strong style="color: var(--warning);"><i class="fas fa-check-double"></i> Confirmation Mode:</strong> 
            Designed for users who may tap unconsciously. When enabled, the first tap won't be recorded immediately. You must tap a second time (within 1-3 seconds) to confirm it as a conscious action.
            <ul style="font-size: 12px; margin-top: 5px; color: var(--text-light);">
                <li>Only the timestamp of the <strong>first</strong> tap is recorded.</li>
                <li>Confirmation mode only applies when the mindfulness level is at <strong>Low</strong>.</li>
				<li>Note: Haptic feedback requires a device that supports vibration mode.</li>
            </ul>
        </li>
    </ul>
</div>

<div style="text-align: center; margin: 15px 0;">
    <img src="./images/2en.png" alt="Meditation Mode" style="max-width: 300px; width: 100%; border-radius: 8px; border: 1px solid var(--border);">
</div>


            <ul style="padding-left: 20px;">
                <li><strong>Manual Entry:</strong> Forgot to start the timer? You can manually log a session or edit previous records.</li>
            </ul>
            <h4 style="color: var(--primary); margin-top: 15px;">3. Statistics & Data Analysis</h4>
            <ul style="padding-left: 20px;">
                <li><strong>Dashboard:</strong> View today's progress relative to your set goals.</li>
                <li><strong>Practice Calendar:</strong> A grid heatmap showing daily practice intensity. More colors represent longer practice durations.</li>
                <li><strong>Visual Charts:</strong>
                    <ul>
                        <li><strong>Session Graph:</strong> Review mindfulness levels <em>within a specific session</em> (line chart).</li>
                        <li><strong>Weekly/Monthly Statistics:</strong> Compare performance over real-time intervals.</li>
                        <li><strong>üíé Pro Chart:</strong> The "Advanced" tab displays the distribution of focus quality (High/Low) over weeks.</li>
                    </ul>
                </li>
            </ul>

            <h4 style="color: var(--primary); margin-top: 15px;">4. Meditation Analytics</h4>
            <p>The <strong>"Analytics"</strong> tab helps you reflect on the quality of your mind during meditation sessions with higher precision.</p>
            <ul style="padding-left: 20px;">
                <li><strong>Goal-specific analysis:</strong> You can view data for specific goals (e.g., "Sitting Meditation" or "Walking Meditation") to compare the progress of different practices.</li>
                
                <li style="margin-top: 10px;">
                    <strong> Distraction Threshold:</strong>
                    <p style="font-size: 13px; color: var(--text-light); margin-top: 5px;">
                        This is the most important concept for calculating your "Meditation Quality."
                    </p>
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 6px; border-left: 3px solid var(--warning); margin: 5px 0;">
            <em>"Distraction Threshold" is the maximum allowed gap between two mindfulness logs; if this time is exceeded, the system considers you were distracted.</em>
        </div>
        <ul style="margin-top: 5px;">
            <li><strong>How it works:</strong> For example, if you set the threshold to <strong>12 seconds</strong>:
                <ul>
                    <li>If you tap after <strong>5 seconds</strong>: The entire duration is counted as Mindful.</li>
                    <li>If you tap after <strong>20 seconds</strong>: The system calculates that you were distracted or drowsy for <strong>8 seconds</strong> (20 - 12 = 8).</li>
                </ul>
            </li>
            <li><strong>Individual Customization:</strong> Different practices require different paces. You can set a low threshold (e.g., 5s) for fast-noting exercises, or a higher threshold (e.g., 30s) for deep concentration. The system remembers these settings for each goal individually.</li>
        </ul>
    </li>
</ul>

            <h4 style="color: var(--primary); margin-top: 15px;">5. Privacy & Data Security</h4>
            <ul style="padding-left: 20px;">
                <li><strong>Fully Offline:</strong> 100% of data is stored directly in your browser. No data is sent to any server.</li>
                <li><strong>Backup & Restore:</strong> Easily export data to a <code>.json</code> file for safekeeping or to transfer to another device.</li>
            </ul>

            <hr style="border: 0; border-top: 1px solid var(--border); margin: 25px 0;">
<h3 style="color: var(--text); margin-top: 20px;">‚ú® The PƒÅramƒ´ System (Achievements)</h3>

<p> The achievements system is organized into PƒÅramƒ´s (Virtues) to encourage your diligence. Your progress is further categorized into spiritual faculties (Indrƒ´ya) & powers (Bala). Here are some key milestones:</p>

            <p><strong>Consistency Milestones (SaddhƒÅ-bala):</strong></p>
            <table class="intro-table" style="width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 13px;">
                <thead>
                    <tr style="background: var(--bg);">
                        <th style="padding: 8px; border: 1px solid var(--border); text-align: left;">Streak</th>
                        <th style="padding: 8px; border: 1px solid var(--border); text-align: left;">Badge Title</th>
                        <th style="padding: 8px; border: 1px solid var(--border); text-align: left;">Significance</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td style="padding: 8px; border: 1px solid var(--border);">3 Days</td><td style="padding: 8px; border: 1px solid var(--border);">Walking Path</td><td style="padding: 8px; border: 1px solid var(--border);">Stepping onto the path.</td></tr>
                    <tr><td style="padding: 8px; border: 1px solid var(--border);">7 Days</td><td style="padding: 8px; border: 1px solid var(--border);">Blessings</td><td style="padding: 8px; border: 1px solid var(--border);">Generating wholesome roots.</td></tr>
                    <tr><td style="padding: 8px; border: 1px solid var(--border);">30 Days</td><td style="padding: 8px; border: 1px solid var(--border);">Willpower</td><td style="padding: 8px; border: 1px solid var(--border);">Determination becomes habit.</td></tr>
                    <tr><td style="padding: 8px; border: 1px solid var(--border);">100 Days</td><td style="padding: 8px; border: 1px solid var(--border);">Lion‚Äôs Roar</td><td style="padding: 8px; border: 1px solid var(--border);">Fearless consistency.</td></tr>
                    <tr><td style="padding: 8px; border: 1px solid var(--border);">365 Days</td><td style="padding: 8px; border: 1px solid var(--border);">Timeless</td><td style="padding: 8px; border: 1px solid var(--border);">Practice beyond time.</td></tr>
                </tbody>
            </table>

            <p><strong>Mindfulness Milestones (Sati-indrƒ´ya):</strong></p>
            <table class="intro-table" style="width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 13px;">
                <thead>
                   <tr style="background: var(--bg);">
                        <th style="padding: 8px; border: 1px solid var(--border); text-align: left;">Count</th>
                        <th style="padding: 8px; border: 1px solid var(--border); text-align: left;">Badge Title</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td style="padding: 8px; border: 1px solid var(--border);">100</td><td style="padding: 8px; border: 1px solid var(--border);">One-Pointedness</td></tr>
                    <tr><td style="padding: 8px; border: 1px solid var(--border);">1,000</td><td style="padding: 8px; border: 1px solid var(--border);">Contentment</td></tr>
                    <tr><td style="padding: 8px; border: 1px solid var(--border);">10,000</td><td style="padding: 8px; border: 1px solid var(--border);">Offering</td></tr>
                    <tr><td style="padding: 8px; border: 1px solid var(--border);">50,000</td><td style="padding: 8px; border: 1px solid var(--border);">Bliss</td></tr>
                    <tr><td style="padding: 8px; border: 1px solid var(--border);">100,000</td><td style="padding: 8px; border: 1px solid var(--border);">Suchness</td></tr>
                </tbody>
            </table>
            
            <p style="font-size: 13px; color: var(--text-light); font-style: italic;">
                * Other achievements track <strong>Total Time (Viriya)</strong>, <strong>Session Frequency</strong>, and <strong>Concentration Levels (SamƒÅdhi)</strong>.
            </p>
<br>
            <div style="background: rgba(251, 191, 36, 0.1); border: 1px solid var(--warning); padding: 15px; border-radius: 8px; color: #fbbf24; font-size: 13px;">
                <strong>‚ö†Ô∏è Important Data Notice:</strong>
                <ul style="margin: 5px 0 0 15px;">
                    <li>Data is stored in the browser's <strong>IndexedDB</strong> (Secure & Large capacity).</li>
                    <li><strong>Do not clear browser history/cache</strong> without backing up, or your data will be lost.</li>
                    <li><strong>How to Backup:</strong> Go to the left sidebar, select <strong>"Backup"</strong> to download the file.</li>
                    <li><strong>How to Restore:</strong> Select <strong>"Restore"</strong> and upload your backup file.</li>
                </ul>
            </div>
            
             <div style="margin-top: 20px; text-align: center; color: var(--text-light); font-size: 12px; border-top: 1px solid var(--border); padding-top: 10px;">
                <strong>Technologies:</strong> HTML5, CSS3, JS (ES6+).<br>
                <strong>Libraries:</strong> <a href="https://www.chartjs.org/" target="_blank" style="color: var(--primary); text-decoration: none;">Chart.js</a>, <a href="https://fontawesome.com/" target="_blank" style="color: var(--primary); text-decoration: none;">FontAwesome</a>.<br>
                Download Link & Source Code: <a href="https://github.com/buddhanussati/meditator-journal/releases"><b>here.</b></a> Wishing you peace and diligence!
            </div>
        </div>
        
        <div style="padding: 15px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; background: var(--surface); border-radius: 0 0 16px 16px;">
            <button class="btn btn-secondary" onclick="app.closeIntroModal()">Close</button>
        </div>
    </div>
</div>
    <audio id="bell" src="./audio/bell.mp3" preload="auto"></audio>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw2.js')
        .then(reg => console.log('PWA ready:', reg.scope))
        .catch(err => console.log('PWA error:', err));
    });
  }
</script>
   <script src="./js/mj.js"></script>
</body>
</html>